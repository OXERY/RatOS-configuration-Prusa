# WARNING. DO NOT EDIT THIS FILE.
# To override settings from this file, you can copy and paste the relevant
# sections into your printer.cfg and change it there.

[include ../base.cfg]

[heater_bed]
heater_pin: heater_bed_heating_pin
sensor_pin: heater_bed_sensor_pin
sensor_type: EPCOS 100K B57560G104F
min_temp: 0
max_temp: 125
max_power: 1.0

[save_variables]
filename: ~/variables.cfg

[fan]
pin: fan_part_cooling_pin

[heater_fan toolhead_cooling_fan]
pin: fan_toolhead_cooling_pin
fan_speed: 1
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0

[printer]
kinematics: cartesian

[bed_mesh]
speed: 150.0
mesh_min: 24, 1
mesh_max: 231,212
move_check_distance: 3.0
split_delta_z: .025
# Odd number of probe points per dimension (3x3, 5x5, 7x7) is better as then the area near the center screw is probed
#probe_count: 7,7
#probe_count: 5,5
probe_count: 3,3				
mesh_pps: 2,2					#Only 2 interpolations per point
algorithm: bicubic
#relative_reference_index: 24 # 7x7
#relative_reference_index: 12 # 5x5
relative_reference_index: 4 # 3x3
fade_start: 1.0
fade_end: 10.0

# Avoid magnets
faulty_region_1_min: 2.672, 2.876
faulty_region_1_max: 9.172, 29.876
faulty_region_2_min: 1.922, 33.376
faulty_region_2_max: 8.422, 60.376
faulty_region_3_min: 2.205, 62.701
faulty_region_3_max: 8.705, 89.701
faulty_region_4_min: 3.205, 124.194
faulty_region_4_max: 9.705, 151.194
faulty_region_5_min: 2.672, 156.620
faulty_region_5_max: 9.172, 183.620
faulty_region_6_min: 1.197, 187.317
faulty_region_6_max: 7.697, 214.317
faulty_region_7_min: 1.439, 217.126
faulty_region_7_max: 28.439, 223.626
faulty_region_8_min: 64.180, 216.052
faulty_region_8_max: 91.180, 222.552
faulty_region_9_min: 108.083, 194.876
faulty_region_9_max: 114.583, 221.876
faulty_region_10_min: 158.164, 216.052
faulty_region_10_max: 185.164, 222.552
faulty_region_11_min: 219.731, 216.911
faulty_region_11_max: 246.731, 223.411
faulty_region_12_min: 240.922, 154.748
faulty_region_12_max: 247.422, 181.748
faulty_region_13_min: 240.639, 123.974
faulty_region_13_max: 247.139, 150.974
faulty_region_14_min: 240.639, 63.110
faulty_region_14_max: 247.139, 90.110
faulty_region_15_min: 240.922, 29.429
faulty_region_15_max: 247.422, 56.429
faulty_region_16_min: 194.761, -14.374
faulty_region_16_max: 221.761, -7.874
faulty_region_17_min: 162.261, -14.374
faulty_region_17_max: 189.261, -7.874
faulty_region_18_min: 133.172, -10.624
faulty_region_18_max: 139.672, 16.376
faulty_region_19_min: 61.083, -14.374
faulty_region_19_max: 88.083, -7.874
faulty_region_20_min: 28.583, -14.374
faulty_region_20_max: 55.583, -7.874
faulty_region_21_min: 199.761, 12.626
faulty_region_21_max: 226.761, 19.126
faulty_region_22_min: 121.922, 47.376
faulty_region_22_max: 128.422, 74.376
faulty_region_23_min: 28.922, 94.626
faulty_region_23_max: 35.422, 121.626
faulty_region_24_min: 61.672, 104.876
faulty_region_24_max: 88.672, 111.376
faulty_region_25_min: 161.672, 104.876
faulty_region_25_max: 188.672, 111.376
faulty_region_26_min: 212.636, 94.626
faulty_region_26_max: 219.136, 121.626
faulty_region_27_min: 121.922, 141.876
faulty_region_27_max: 128.422, 168.876
faulty_region_28_min: 183.677, 198.894
faulty_region_28_max: 210.677, 205.394



[force_move]
enable_force_move: True

[homing_override]
gcode:
    M400                  # Wait for moves to finish
    G90                   # Absolute positioning
    G1 Z10 F7200          # Hop Z-Axis
    M204 S1000            # Set homing acceleration (important!)

    M117 Homing...

    # Get currents
    {% if printer["gcode_macro _stepper_type"].tmc2209|int == 1 %}
    {% set x_driver_config = printer.configfile.settings['tmc2209 stepper_x'] %}
    {% set y_driver_config = printer.configfile.settings['tmc2209 stepper_y'] %}
	{% else %}
    {% set x_driver_config = printer.configfile.settings['tmc2130 stepper_x'] %}
    % set y_driver_config = printer.configfile.settings['tmc2130 stepper_y'] %}
	{% endif %}
    {% set X_RUN_CUR = x_driver_config.run_current %}
    {% set Y_RUN_CUR = y_driver_config.run_current %}

    # Set currents
    SET_TMC_CURRENT STEPPER=stepper_x CURRENT=0.13
    SET_TMC_CURRENT STEPPER=stepper_y CURRENT=0.13

    # Home X
    G28 X
    M400
    G1 X10 F1000
    M400
    G28 X

    # Home Y
    
    G28 Y
    M400
    G1 Y10 F1000
    M400
    G28 Y

    # Home Z
    G1 X101 Y100 F7200
    G28 Z0
    M400

    # Reset Stepper Current
    SET_TMC_CURRENT STEPPER=stepper_x CURRENT={X_RUN_CUR}
    SET_TMC_CURRENT STEPPER=stepper_y CURRENT={Y_RUN_CUR}

    # Reset LCD
    M117

    # Park
    G1 Z10 F7200

    # Restore acceleration
    M204 S{printer.configfile.config.printer.max_accel}

[respond]
default_type: command

[static_digital_output debug_led]
pins: !PB7

[probe]
pin: !probe_pin #inverted, due to my supcrprobe
x_offset: 24
y_offset: 5
speed: 5.0
samples: 3
sample_retract_dist: 0.40
samples_tolerance: 0.2
lift_speed: 10
samples_result: average


